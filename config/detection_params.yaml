# Headlight and tail light detection parameters

# HSV color ranges for light detection.
# Red wraps around the hue wheel, so it needs two separate ranges.
hsv_ranges:
  red:                              # Rear tail lights
    lower1: [0, 100, 100]          # [H, S, V]
    upper1: [10, 255, 255]
    lower2: [170, 100, 100]        # Red hue wraps at 180, hence the second range
    upper2: [180, 255, 255]

  white:                            # License plate, brake, reverse lights
    lower: [0, 0, 200]
    upper: [180, 30, 255]

  yellow_white:                     # Front headlights
    lower: [15, 50, 150]
    upper: [35, 255, 255]


# Blob detector parameters (passed to cv2.SimpleBlobDetector)
blob_detection:
  min_area: 50            # Minimum blob area in pixels
  max_area: 5000          # Maximum blob area in pixels
  min_circularity: 0.1    # 0 = any shape, 1 = perfect circle
  min_convexity: 0.5
  min_inertia_ratio: 0.15  # Low = elongated, high = circular


# Morphological operations applied to the HSV mask before blob detection
morphology:
  kernel_size: [5, 5]
  open_iterations: 1    # MORPH_OPEN  — removes small noise
  close_iterations: 1   # MORPH_CLOSE — fills small holes inside blobs


# Heuristics for pairing left/right tail lights
tail_lights_selection:
  min_horizontal_distance: 50         # Minimum pixel distance between the two lights
  max_horizontal_distance_ratio: 0.8  # Maximum distance relative to frame width
  max_vertical_offset: 60             # Max allowed vertical misalignment in pixels
  min_area_similarity: 0.3            # Min area ratio between the two blobs (0–1)
  min_pair_score: 0.25                # Pairs below this score are discarded


# Tracker settings — used between detections to reduce per-frame cost
tracking:
  # Options: CSRT (accurate, slow), KCF (fast, less accurate), MOSSE (fastest)
  tracker_type: "CSRT"
  bbox_padding: 20       # Pixels added around the detected point to build the tracker bbox
  max_frames_lost: 10    # Frames without a detection before forcing a re-detection


# Re-detection strategy when the tracker loses the target
redetection:
  confidence_threshold: 0.6    # Tracker confidence below this triggers re-detection
  enable_kalman_prediction: true
  search_region_scale: 2.5     # Search area = tracker bbox × this scale factor


# Drawing options (all colors in BGR)
visualization:
  draw_detections: true
  draw_tracking: true
  draw_bbox_3d: true
  point_color: [0, 255, 0]    # Green
  bbox_color: [255, 0, 0]     # Blue
  line_thickness: 2


debug:
  save_masks: false             # Dump HSV masks to disk
  save_detection_frames: false  # Dump frames with drawn detections to disk
  verbose: true


# License plate detection
license_plate_detection:
  edge_detection:
    canny_low: 50
    canny_high: 150
    blur_kernel: 5    # Gaussian blur kernel size before Canny

  contour_filter:
    min_area: 1000            # px²
    max_area: 50000           # px²
    aspect_ratio_min: 2.5     # EU plate is ~4.7:1
    aspect_ratio_max: 6.0
    min_solidity: 0.7         # contour_area / convex_hull_area

  epsilon_factor: 0.02        # Polygon approximation tolerance (fraction of arc length)